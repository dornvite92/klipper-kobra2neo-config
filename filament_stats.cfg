# =============================================================================
# FILAMENT STATS - Statystyki zużycia filamentu
# =============================================================================
# Makra do wyświetlania statystyk zużycia w konsoli Mainsail
# Dashboard dostępny pod: http://[IP]/filament/
# Autor: Claude Code | Data: 2025-12-30
# =============================================================================

[gcode_macro FILAMENT_STATS]
description: Wyświetla statystyki zużycia filamentu (dashboard: /filament/)
gcode:
    {% set stats = printer.print_stats %}

    RESPOND MSG="============================================"
    RESPOND MSG="       FILAMENT STATISTICS"
    RESPOND MSG="============================================"
    RESPOND MSG=""
    RESPOND MSG="Dashboard: http://[IP_DRUKARKI]/filament/"
    RESPOND MSG=""
    RESPOND MSG="Aby odświeżyć dane dashboardu:"
    RESPOND MSG="  SSH: python3 ~/filament_dashboard/filament_stats.py"
    RESPOND MSG=""
    RESPOND MSG="Bieżąca sesja:"
    RESPOND MSG="  Stan: {stats.state}"
    {% if stats.filename %}
    RESPOND MSG="  Plik: {stats.filename}"
    RESPOND MSG="  Filament: {(stats.filament_used / 1000)|round(2)} m"
    RESPOND MSG="  Czas druku: {(stats.print_duration / 60)|round(1)} min"
    {% endif %}
    RESPOND MSG="============================================"


[gcode_macro FILAMENT_REFRESH]
description: Odświeża dane statystyk filamentu (wymaga połączenia SSH w tle)
gcode:
    RESPOND MSG="Odświeżanie statystyk..."
    RESPOND MSG="Wykonaj w terminalu SSH:"
    RESPOND MSG="  python3 ~/filament_dashboard/filament_stats.py"
    RESPOND MSG="Następnie odśwież dashboard w przeglądarce."


[gcode_macro FILAMENT_USAGE]
description: Pokazuje szybkie podsumowanie zużycia z aktualnego druku
gcode:
    {% set stats = printer.print_stats %}
    {% if stats.filament_used > 0 %}
        {% set used_m = (stats.filament_used / 1000)|round(2) %}
        {% set weight_g = (used_m * 3)|round(1) %}
        M117 Filament: {used_m}m (~{weight_g}g)
        RESPOND MSG="Zużycie bieżące: {used_m} m (~{weight_g} g)"
    {% else %}
        M117 Brak danych
        RESPOND MSG="Brak aktywnego druku lub danych o zużyciu"
    {% endif %}
